#!/usr/bin/env python3
# Obfuscated with custom obfuscator
import base64
exec(base64.b64decode('IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKQWR2YW5jZWQgWFNTIFNjYW5uZXIgVG9vbApTaW1pbGFyIHRvIHhzc2VyIHRvb2wgLSBDcm9zcyBTaXRlIFNjcmlwdGluZyB2dWxuZXJhYmlsaXR5IHNjYW5uZXIKIiIiCgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHVybGxpYi5wYXJzZQppbXBvcnQgcmUKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IGpzb24KaW1wb3J0IGh0bWwKaW1wb3J0IGJhc2U2NAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgb3MKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAKZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHVybGpvaW4sIHVybHBhcnNlLCBwYXJzZV9xcywgdXJsZW5jb2RlLCBxdW90ZSwgdW5xdW90ZQppbXBvcnQgdGhyZWFkaW5nCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKaW1wb3J0IHN5cwpmcm9tIGNvbG9yYW1hIGltcG9ydCBGb3JlLCBCYWNrLCBTdHlsZSwgaW5pdApmcm9tIHNlbGVuaXVtIGltcG9ydCB3ZWJkcml2ZXIKZnJvbSBzZWxlbml1bS53ZWJkcml2ZXIuY2hyb21lLm9wdGlvbnMgaW1wb3J0IE9wdGlvbnMKZnJvbSBzZWxlbml1bS53ZWJkcml2ZXIuY29tbW9uLmJ5IGltcG9ydCBCeQpmcm9tIHNlbGVuaXVtLndlYmRyaXZlci5zdXBwb3J0LnVpIGltcG9ydCBXZWJEcml2ZXJXYWl0CmZyb20gc2VsZW5pdW0ud2ViZHJpdmVyLnN1cHBvcnQgaW1wb3J0IGV4cGVjdGVkX2NvbmRpdGlvbnMgYXMgRUMKCiMgSW5pdGlhbGl6ZSBjb2xvcmFtYSBmb3IgY29sb3JlZCBvdXRwdXQKaW5pdChhdXRvcmVzZXQ9VHJ1ZSkKCmNsYXNzIFhTU1NjYW5uZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdGFyZ2V0X3VybCwgdGhyZWFkcz0xMCwgZGVsYXk9MCwgdmVyYm9zZT1GYWxzZSwgdXNlcl9hZ2VudD1Ob25lLCBvdXRwdXRfZmlsZT1Ob25lLCBicm93c2VyX3ZlcmlmeT1UcnVlKToKICAgICAgICBzZWxmLnRhcmdldF91cmwgPSB0YXJnZXRfdXJsCiAgICAgICAgc2VsZi50aHJlYWRzID0gdGhyZWFkcwogICAgICAgIHNlbGYuZGVsYXkgPSBkZWxheQogICAgICAgIHNlbGYudmVyYm9zZSA9IHZlcmJvc2UKICAgICAgICBzZWxmLnNlc3Npb24gPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgICAgICBzZWxmLnZ1bG5lcmFiaWxpdGllcyA9IFtdCiAgICAgICAgc2VsZi50ZXN0ZWRfdXJscyA9IHNldCgpCiAgICAgICAgc2VsZi5vdXRwdXRfZmlsZSA9IG91dHB1dF9maWxlIG9yIGYieHNzX3NjYW5fcmVzdWx0c197aW50KHRpbWUudGltZSgpKX0uanNvbiIKICAgICAgICBzZWxmLmJyb3dzZXJfdmVyaWZ5ID0gYnJvd3Nlcl92ZXJpZnkKICAgICAgICBzZWxmLmRldGVjdGVkX3dhZiA9IE5vbmUKICAgICAgICAKICAgICAgICAjIFNldCB1c2VyIGFnZW50CiAgICAgICAgaWYgdXNlcl9hZ2VudDoKICAgICAgICAgICAgc2VsZi5zZXNzaW9uLmhlYWRlcnMudXBkYXRlKHsnVXNlci1BZ2VudCc6IHVzZXJfYWdlbnR9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbi5oZWFkZXJzLnVwZGF0ZSh7CiAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTIwLjAuMC4wIFNhZmFyaS81MzcuMzYnCiAgICAgICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgIyBJbml0aWFsaXplIGJyb3dzZXIgZm9yIHZlcmlmaWNhdGlvbgogICAgICAgIGlmIHNlbGYuYnJvd3Nlcl92ZXJpZnk6CiAgICAgICAgICAgIHNlbGYuaW5pdF9icm93c2VyKCkKICAgICAgICAKICAgICAgICAjIFdBRi1zcGVjaWZpYyBieXBhc3MgcGF5bG9hZHMKICAgICAgICBzZWxmLndhZl9ieXBhc3NfcGF5bG9hZHMgPSB7CiAgICAgICAgICAgICdDbG91ZGZsYXJlJzogWwogICAgICAgICAgICAgICAgJzxzdmcvb25sb2FkPWFsZXJ0KDEpPicsCiAgICAgICAgICAgICAgICAnPGlmcmFtZSBzcmNkb2M9IiZsdDtpbWcgc3JjJmVxdWFsczt4Onggb25lcnJvciZlcXVhbHM7YWxlcnQmbHBhcjsxJnJwYXI7Jmd0OyIgLz4nLAogICAgICAgICAgICAgICAgJzxtYXRoPjxtaS8veGxpbms6aHJlZj0iZGF0YTp4LDxzY3JpcHQ+YWxlcnQoMSk8L3NjcmlwdD4iPicsCiAgICAgICAgICAgICAgICAnamF2YXNjcmlwdDovKjwvdGl0bGU+PC9zdHlsZT48L3RleHRhcmVhPjwvc2NyaXB0PjwveG1wPjxzdmcvb25sb2FkPVwnLyoqL2FsZXJ0KDEpXCc+JwogICAgICAgICAgICBdLAogICAgICAgICAgICAnQWthbWFpJzogWwogICAgICAgICAgICAgICAgJzxkZXRhaWxzIG9wZW4gb250b2dnbGU9YWxlcnQoMSk+JywKICAgICAgICAgICAgICAgICc8bWFycXVlZSBvbnN0YXJ0PWFsZXJ0KDEpPicsCiAgICAgICAgICAgICAgICAnPG9iamVjdCBkYXRhPSJkYXRhOnRleHQvaHRtbCw8c2NyaXB0PmFsZXJ0KDEpPC9zY3JpcHQ+Ij4nLAogICAgICAgICAgICAgICAgJ2phdmFzY3JpcHQ6YWxlcnQoU3RyaW5nLmZyb21DaGFyQ29kZSg4OCw4Myw4MykpJwogICAgICAgICAgICBdLAogICAgICAgICAgICAnTW9kU2VjdXJpdHknOiBbCiAgICAgICAgICAgICAgICAnPGltZyBzcmM9eCBvbmVycm9yPWV2YWwoYXRvYigiWVd4bGNuUW9NU2s9IikpPicsCiAgICAgICAgICAgICAgICAnPHNjcmlwdD5GdW5jdGlvbmBhbGVydFxcdTAwMjgxXFx1MDAyOWBgYDwvc2NyaXB0PicsCiAgICAgICAgICAgICAgICAnPHN2Zz48c2NyaXB0PmFsZXJ0JiM0MDsxJiM0MTs8L3NjcmlwdD48L3N2Zz4nLAogICAgICAgICAgICAgICAgJ2phdmFzY3JpcHQ6LyotLT48L3RpdGxlPjwvc3R5bGU+PC90ZXh0YXJlYT48L3NjcmlwdD48L3htcD48c3ZnL29ubG9hZD1cJysvIi8rL29ubW91c2VvdmVyPTEvKy9bKi9bXS8rYWxlcnQoMSkvL1wnPicKICAgICAgICAgICAgXSwKICAgICAgICAgICAgJ0FXUyBXQUYnOiBbCiAgICAgICAgICAgICAgICAnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6YWxlcnRgMWAiPicsCiAgICAgICAgICAgICAgICAnPHN2ZyBvbmxvYWQ9IltdLmZvckVhY2guY2FsbChbXSxhbGVydCwxKSI+JywKICAgICAgICAgICAgICAgICc8c2NyaXB0PnNldFRpbWVvdXQoYWxlcnQsMCwxKTwvc2NyaXB0PicsCiAgICAgICAgICAgICAgICAnPGltZyBzcmM9eCBvbmVycm9yPSJbXS5jb25zdHJ1Y3Rvci5jb25zdHJ1Y3RvcihcJ2FsZXJ0KDEpXCcpKCk7Ij4nCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICdJbXBlcnZhIChJbmNhcHN1bGEpJzogWwogICAgICAgICAgICAgICAgJzxzY3JpcHQ+YWxlcnQoU3RyaW5nWyJmcm9tQ2hhckNvZGUiXSg0OSkpPC9zY3JpcHQ+JywKICAgICAgICAgICAgICAgICc8aW1nIHNyYz14IG9uZXJyb3I9YWxlcnQoU3RyaW5nLmZyb21DaGFyQ29kZSg0OSkpPicsCiAgICAgICAgICAgICAgICAnPHN2ZyBvbmxvYWQ9YWxlcnQoLzEvLnNvdXJjZSk+JywKICAgICAgICAgICAgICAgICc8c2NyaXB0PiR7YWxlcnRgMWB9PC9zY3JpcHQ+JwogICAgICAgICAgICBdCiAgICAgICAgfQogICAgICAgIAogICAgICAgICMgRW5oYW5jZWQgY29tcHJlaGVuc2l2ZSBYU1MgcGF5bG9hZHMKICAgICAgICBzZWxmLnBheWxvYWRzID0gWwogICAgICAgICAgICAjIEJhc2ljIHBheWxvYWRzCiAgICAgICAgICAgICc8c2NyaXB0PmFsZXJ0KCJYU1MiKTwvc2NyaXB0PicsCiAgICAgICAgICAgICc8aW1nIHNyYz14IG9uZXJyb3I9YWxlcnQoIlhTUyIpPicsCiAgICAgICAgICAgICc8c3ZnIG9ubG9hZD1hbGVydCgiWFNTIik+JywKICAgICAgICAgICAgJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OmFsZXJ0KFwnWFNTXCcpIj48L2lmcmFtZT4nLAogICAgICAgICAgICAnPGJvZHkgb25sb2FkPWFsZXJ0KCJYU1MiKT4nLAogICAgICAgICAgICAnPGRpdiBvbm1vdXNlb3Zlcj1hbGVydCgiWFNTIik+JywKICAgICAgICAgICAgJzxpbnB1dCBvbmZvY3VzPWFsZXJ0KCJYU1MiKSBhdXRvZm9jdXM+JywKICAgICAgICAgICAgJzxkZXRhaWxzIG9wZW4gb250b2dnbGU9YWxlcnQoIlhTUyIpPicsCiAgICAgICAgICAgICc8bWFycXVlZSBvbnN0YXJ0PWFsZXJ0KCJYU1MiKT4nLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBBZHZhbmNlZCBwYXlsb2FkcwogICAgICAgICAgICAnIj48c2NyaXB0PmFsZXJ0KCJYU1MiKTwvc2NyaXB0PicsCiAgICAgICAgICAgICInPjxzY3JpcHQ+YWxlcnQoJ1hTUycpPC9zY3JpcHQ+IiwKICAgICAgICAgICAgJzxzY3JpcHQ+YWxlcnQoU3RyaW5nLmZyb21DaGFyQ29kZSg4OCw4Myw4MykpPC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxpbWcgc3JjPSJ4IiBvbmVycm9yPSJhbGVydChcJ1hTU1wnKSIgLz4nLAogICAgICAgICAgICAnPHN2Zy9vbmxvYWQ9YWxlcnQoL1hTUy8pPicsCiAgICAgICAgICAgICc8aWZyYW1lIHNyYz1qYXZhc2NyaXB0OmFsZXJ0KDEpPicsCiAgICAgICAgICAgICc8b2JqZWN0IGRhdGE9ImphdmFzY3JpcHQ6YWxlcnQoMSkiPicsCiAgICAgICAgICAgICc8ZW1iZWQgc3JjPSJqYXZhc2NyaXB0OmFsZXJ0KDEpIj4nLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBGaWx0ZXIgYnlwYXNzIHBheWxvYWRzCiAgICAgICAgICAgICc8U2NSaVB0PmFsZXJ0KCJYU1MiKTwvU2NSaVB0PicsCiAgICAgICAgICAgICc8SU1HIFNSQz1qYXZhc2NyaXB0OmFsZXJ0KCJYU1MiKT4nLAogICAgICAgICAgICAnPElNRyBTUkM9ImphdiYjeDA5O2FzY3JpcHQ6YWxlcnQoXCdYU1NcJyk7Ij4nLAogICAgICAgICAgICAnPElNRyBTUkM9ImphdiYjeDBBO2FzY3JpcHQ6YWxlcnQoXCdYU1NcJyk7Ij4nLAogICAgICAgICAgICAnPElNRyBTUkM9ImphdiYjeDBEO2FzY3JpcHQ6YWxlcnQoXCdYU1NcJyk7Ij4nLAogICAgICAgICAgICAnPGltZyBzcmM9eCBvbmVycm9yPWV2YWwoYXRvYigiWVd4bGNuUW9KMWhUVXljcE93PT0iKSk+JywKICAgICAgICAgICAgJzxpbWcgc3JjPSJ4IiBvbmVycm9yPSImIzk3OyYjMTA4OyYjMTAxOyYjMTE0OyYjMTE2OyYjNDA7JiMzOTsmIzg4OyYjODM7JiM4MzsmIzM5OyYjNDE7Ij4nLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBDb250ZXh0LXNwZWNpZmljIHBheWxvYWRzCiAgICAgICAgICAgICdqYXZhc2NyaXB0OmFsZXJ0KCJYU1MiKScsCiAgICAgICAgICAgICd2YnNjcmlwdDptc2dib3goIlhTUyIpJywKICAgICAgICAgICAgJ29ubG9hZD0iYWxlcnQoXCdYU1NcJykiJywKICAgICAgICAgICAgJ29uZm9jdXM9ImFsZXJ0KFwnWFNTXCcpIicsCiAgICAgICAgICAgICdvbm1vdXNlb3Zlcj0iYWxlcnQoXCdYU1NcJykiJywKICAgICAgICAgICAgJ29uY2xpY2s9ImFsZXJ0KFwnWFNTXCcpIicsCiAgICAgICAgICAgICdvbnN1Ym1pdD0iYWxlcnQoXCdYU1NcJykiJywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRE9NLWJhc2VkIHBheWxvYWRzCiAgICAgICAgICAgICcjPHNjcmlwdD5hbGVydCgiWFNTIik8L3NjcmlwdD4nLAogICAgICAgICAgICAnamF2YXNjcmlwdDp2b2lkKGFsZXJ0KCJYU1MiKSknLAogICAgICAgICAgICAnPHNjcmlwdD5kb2N1bWVudC53cml0ZSgiPGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPiIpPC9zY3JpcHQ+JywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgRXZlbnQgaGFuZGxlciBwYXlsb2FkcwogICAgICAgICAgICAnPHNlbGVjdCBvbmZvY3VzPWFsZXJ0KCJYU1MiKSBhdXRvZm9jdXM+JywKICAgICAgICAgICAgJzx0ZXh0YXJlYSBvbmZvY3VzPWFsZXJ0KCJYU1MiKSBhdXRvZm9jdXM+JywKICAgICAgICAgICAgJzxrZXlnZW4gb25mb2N1cz1hbGVydCgiWFNTIikgYXV0b2ZvY3VzPicsCiAgICAgICAgICAgICc8dmlkZW8+PHNvdXJjZSBvbmVycm9yPSJhbGVydChcJ1hTU1wnKSIgc3JjPSIiPicsCiAgICAgICAgICAgICc8YXVkaW8gc3JjPXggb25lcnJvcj1hbGVydCgiWFNTIik+JywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQWR2YW5jZWQgZXZhc2lvbgogICAgICAgICAgICAnPHNjcmlwdD5hbGVydGBYU1NgPC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxzY3JpcHQ+YWxlcnQoU3RyaW5nWyJmcm9tQ2hhckNvZGUiXSg4OCw4Myw4MykpPC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxpbWcgc3JjPSJ4IiBvbmVycm9yPWFsZXJ0KFN0cmluZy5mcm9tQ2hhckNvZGUoODgsODMsODMpKT4nLAogICAgICAgICAgICAnPHNjcmlwdD5ldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoOTcsMTA4LDEwMSwxMTQsMTE2LDQwLDM5LDg4LDgzLDgzLDM5LDQxKSk8L3NjcmlwdD4nLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBUZW1wbGF0ZSBsaXRlcmFscwogICAgICAgICAgICAnPHNjcmlwdD4ke2FsZXJ0YFhTU2B9PC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxzY3JpcHQ+c2V0VGltZW91dGBhbGVydFxceDI4ZG9jdW1lbnQuZG9tYWluXFx4MjlgPC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxzY3JpcHQ+RnVuY3Rpb25gYWxlcnRcXHgyOFxceDI5YGBgPC9zY3JpcHQ+JywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVW5pY29kZSBwYXlsb2FkcwogICAgICAgICAgICAnPHNjcmlwdD5cXHUwMDYxXFx1MDA2Q1xcdTAwNjVcXHUwMDcyXFx1MDA3NCgiWFNTIik8L3NjcmlwdD4nLAogICAgICAgICAgICAnPHNjcmlwdD5hbGVydFxcdTAwMjgiWFNTIlxcdTAwMjk8L3NjcmlwdD4nLAogICAgICAgICAgICAnPHNjcmlwdD5cXHg2MVxceDZjXFx4NjVcXHg3MlxceDc0KCJYU1MiKTwvc2NyaXB0PicsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEhUTUw1IHBheWxvYWRzCiAgICAgICAgICAgICc8Zm9ybT48YnV0dG9uIGZvcm1hY3Rpb249ImphdmFzY3JpcHQ6YWxlcnQoXCdYU1NcJykiIGZvcm1tZXRob2Q9InBvc3QiPicsCiAgICAgICAgICAgICc8bWF0aD48bWkvL3hsaW5rOmhyZWY9ImRhdGE6eCw8c2NyaXB0PmFsZXJ0KFwnWFNTXCcpPC9zY3JpcHQ+Ij4nLAogICAgICAgICAgICAnPHN2Zz48YT48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPWhyZWYgdmFsdWVzPWphdmFzY3JpcHQ6YWxlcnQoXCdYU1NcJykgLz48dGV4dCB4PTIwIHk9MjA+Q2xpY2s8L3RleHQ+PC9hPicsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENTUyBpbmplY3Rpb24gcGF5bG9hZHMKICAgICAgICAgICAgJzxzdHlsZT5AaW1wb3J0ImphdmFzY3JpcHQ6YWxlcnQoXCdYU1NcJykiOzwvc3R5bGU+JywKICAgICAgICAgICAgJzxzdHlsZT5ib2R5e2JhY2tncm91bmQ6dXJsKGphdmFzY3JpcHQ6YWxlcnQoXCdYU1NcJykpfTwvc3R5bGU+JywKICAgICAgICAgICAgJzxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iamF2YXNjcmlwdDphbGVydChcJ1hTU1wnKTsiPicsCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE1ldGEgdGFnIHBheWxvYWRzCiAgICAgICAgICAgICc8bWV0YSBodHRwLWVxdWl2PSJyZWZyZXNoIiBjb250ZW50PSIwO3VybD1qYXZhc2NyaXB0OmFsZXJ0KFwnWFNTXCcpOyI+JywKICAgICAgICAgICAgJzxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PVVURi03IiAvPitBRHctc2NyaXB0K0FENC1hbGVydChcJ1hTU1wnKTsrQUR3LStBQzgtc2NyaXB0K0FENC0nLAogICAgICAgICAgICAKICAgICAgICAgICAgIyBBZGRpdGlvbmFsIG1vZGVybiBwYXlsb2FkcwogICAgICAgICAgICAnPGltZyBzcmM9IngiIG9uZXJyb3I9ImZldGNoKFwnLy9ldmlsLmNvbS9cJytkb2N1bWVudC5jb29raWUpIj4nLAogICAgICAgICAgICAnPHN2ZyBvbmxvYWQ9Im5ldyBJbWFnZSgpLnNyYz1cJy8vZXZpbC5jb20vXCcrZG9jdW1lbnQuY29va2llIj4nLAogICAgICAgICAgICAnPHNjcmlwdD5uYXZpZ2F0b3Iuc2VuZEJlYWNvbihcJy8vZXZpbC5jb21cJyxkb2N1bWVudC5jb29raWUpPC9zY3JpcHQ+JywKICAgICAgICAgICAgJzxpZnJhbWUgc3JjZG9jPSI8aW1nIHNyYz14IG9uZXJyb3I9YWxlcnQoXCdYU1NcJyk+Ij4nLAogICAgICAgICAgICAnPGZvcm0gYWN0aW9uPSJqYXZhc2NyaXB0OmFsZXJ0KFwnWFNTXCcpIiBtZXRob2Q9ImdldCI+PGlucHV0IHR5cGU9InN1Ym1pdCI+JywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgWE1ML1hIVE1MIHBheWxvYWRzCiAgICAgICAgICAgICc8IVtDREFUQVs8c2NyaXB0PmFsZXJ0KFwnWFNTXCcpPC9zY3JpcHQ+XV0+JywKICAgICAgICAgICAgJzw/eG1sIHZlcnNpb249IjEuMCI/Pjxyb290PjwhW0NEQVRBWzxzY3JpcHQ+YWxlcnQoXCdYU1NcJyk8L3NjcmlwdD5dXT48L3Jvb3Q+JywKICAgICAgICAgICAgCiAgICAgICAgICAgICMgUG9seWdsb3QgcGF5bG9hZHMKICAgICAgICAgICAgJ2phdmFzY3JpcHQ6LyotLT48L3RpdGxlPjwvc3R5bGU+PC90ZXh0YXJlYT48L3NjcmlwdD48L3htcD48c3ZnL29ubG9hZD1cJysvIi8rL29ubW91c2VvdmVyPTEvKy9bKi9bXS8rYWxlcnQoXCdYU1NcJykvL1wnPicsIAogICAgICAgICAgICAnIj48c3ZnPjxzY3JpcHQ+YWxlcnQoU3RyaW5nLmZyb21DaGFyQ29kZSg4OCw4Myw4MykpPC9zY3JpcHQ+PC9zdmc+JywKICAgICAgICAgICAgJ1wnPjxzdmc+PHNjcmlwdD5hbGVydChTdHJpbmcuZnJvbUNoYXJDb2RlKDg4LDgzLDgzKSk8L3NjcmlwdD48L3N2Zz4nLAogICAgICAgIF0KICAgIAogICAgZGVmIGluaXRfYnJvd3NlcihzZWxmKToKICAgICAgICAiIiJJbml0aWFsaXplIGJyb3dzZXIgZm9yIHZlcmlmaWNhdGlvbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMgPSBPcHRpb25zKCkKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMuYWRkX2FyZ3VtZW50KCctLWhlYWRsZXNzJykKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMuYWRkX2FyZ3VtZW50KCctLW5vLXNhbmRib3gnKQogICAgICAgICAgICBjaHJvbWVfb3B0aW9ucy5hZGRfYXJndW1lbnQoJy0tZGlzYWJsZS1kZXYtc2htLXVzYWdlJykKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMuYWRkX2FyZ3VtZW50KCctLWRpc2FibGUtZ3B1JykKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMuYWRkX2FyZ3VtZW50KCctLWRpc2FibGUtd2ViLXNlY3VyaXR5JykKICAgICAgICAgICAgY2hyb21lX29wdGlvbnMuYWRkX2FyZ3VtZW50KCctLWFsbG93LXJ1bm5pbmctaW5zZWN1cmUtY29udGVudCcpCiAgICAgICAgICAgIHNlbGYuZHJpdmVyID0gd2ViZHJpdmVyLkNocm9tZShvcHRpb25zPWNocm9tZV9vcHRpb25zKQogICAgICAgICAgICBzZWxmLmxvZygiQnJvd3NlciBpbml0aWFsaXplZCBmb3IgdmVyaWZpY2F0aW9uIiwgIlNVQ0NFU1MiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2coZiJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBicm93c2VyOiB7c3RyKGUpfSIsICJXQVJOSU5HIikKICAgICAgICAgICAgc2VsZi5icm93c2VyX3ZlcmlmeSA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYuZHJpdmVyID0gTm9uZQogICAgCiAgICBkZWYgdmVyaWZ5X3hzc19pbl9icm93c2VyKHNlbGYsIHVybCwgcGF5bG9hZCk6CiAgICAgICAgIiIiVmVyaWZ5IFhTUyBleGVjdXRpb24gaW4gYnJvd3NlciIiIgogICAgICAgIGlmIG5vdCBzZWxmLmJyb3dzZXJfdmVyaWZ5IG9yIG5vdCBzZWxmLmRyaXZlcjoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmRyaXZlci5nZXQodXJsKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBTZXQgdXAgYWxlcnQgZGV0ZWN0aW9uCiAgICAgICAgICAgIHNlbGYuZHJpdmVyLmV4ZWN1dGVfc2NyaXB0KCIiIgogICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0VHJpZ2dlcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB3aW5kb3cub3JpZ2luYWxBbGVydCA9IHdpbmRvdy5hbGVydDsKICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCA9IGZ1bmN0aW9uKG1zZykgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydFRyaWdnZXJlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0TWVzc2FnZSA9IG1zZzsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICIiIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgV2FpdCBmb3IgcG90ZW50aWFsIGFsZXJ0CiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2hlY2sgaWYgYWxlcnQgd2FzIHRyaWdnZXJlZAogICAgICAgICAgICBhbGVydF90cmlnZ2VyZWQgPSBzZWxmLmRyaXZlci5leGVjdXRlX3NjcmlwdCgicmV0dXJuIHdpbmRvdy5hbGVydFRyaWdnZXJlZDsiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGFsZXJ0X3RyaWdnZXJlZAogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nKGYiQnJvd3NlciB2ZXJpZmljYXRpb24gZXJyb3I6IHtzdHIoZSl9IiwgIkVSUk9SIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBnZXRfd2FmX2J5cGFzc19wYXlsb2FkcyhzZWxmLCB3YWZfbmFtZSk6CiAgICAgICAgIiIiR2V0IFdBRi1zcGVjaWZpYyBieXBhc3MgcGF5bG9hZHMiIiIKICAgICAgICBpZiB3YWZfbmFtZSBpbiBzZWxmLndhZl9ieXBhc3NfcGF5bG9hZHM6CiAgICAgICAgICAgIHJldHVybiBzZWxmLndhZl9ieXBhc3NfcGF5bG9hZHNbd2FmX25hbWVdCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIGxvZyhzZWxmLCBtZXNzYWdlLCBsZXZlbD0iSU5GTyIpOgogICAgICAgICIiIkxvZ2dpbmcgZnVuY3Rpb24gd2l0aCBjb2xvcmVkIG91dHB1dCIiIgogICAgICAgIHRpbWVzdGFtcCA9IHRpbWUuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBpZiBsZXZlbCA9PSAiSU5GTyI6CiAgICAgICAgICAgIGNvbG9yID0gRm9yZS5DWUFOCiAgICAgICAgZWxpZiBsZXZlbCA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIGNvbG9yID0gRm9yZS5HUkVFTgogICAgICAgIGVsaWYgbGV2ZWwgPT0gIldBUk5JTkciOgogICAgICAgICAgICBjb2xvciA9IEZvcmUuWUVMTE9XCiAgICAgICAgZWxpZiBsZXZlbCA9PSAiRVJST1IiOgogICAgICAgICAgICBjb2xvciA9IEZvcmUuUkVECiAgICAgICAgZWxpZiBsZXZlbCA9PSAiVlVMTiI6CiAgICAgICAgICAgIGNvbG9yID0gRm9yZS5SRUQgKyBCYWNrLllFTExPVwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbG9yID0gRm9yZS5XSElURQogICAgICAgICAgICAKICAgICAgICBpZiBzZWxmLnZlcmJvc2Ugb3IgbGV2ZWwgaW4gWyJTVUNDRVNTIiwgIlZVTE4iLCAiRVJST1IiXToKICAgICAgICAgICAgcHJpbnQoZiJ7Y29sb3J9W3t0aW1lc3RhbXB9XSBbe2xldmVsfV0ge21lc3NhZ2V9IikKCiAgICBkZWYgZ2V0X2Zvcm1zKHNlbGYsIHVybCk6CiAgICAgICAgIiIiRXh0cmFjdCBhbGwgZm9ybXMgZnJvbSBhIHdlYnBhZ2UiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5zZXNzaW9uLmdldCh1cmwsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKHJlc3BvbnNlLmNvbnRlbnQsICdodG1sLnBhcnNlcicpCiAgICAgICAgICAgIGZvcm1zID0gW10KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBmb3JtIGluIHNvdXAuZmluZF9hbGwoJ2Zvcm0nKToKICAgICAgICAgICAgICAgIGZvcm1fZGV0YWlscyA9IHsKICAgICAgICAgICAgICAgICAgICAnYWN0aW9uJzogZm9ybS5nZXQoJ2FjdGlvbicpLAogICAgICAgICAgICAgICAgICAgICdtZXRob2QnOiBmb3JtLmdldCgnbWV0aG9kJywgJ2dldCcpLmxvd2VyKCksCiAgICAgICAgICAgICAgICAgICAgJ2lucHV0cyc6IFtdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBpbnB1dF90YWcgaW4gZm9ybS5maW5kX2FsbChbJ2lucHV0JywgJ3RleHRhcmVhJywgJ3NlbGVjdCddKToKICAgICAgICAgICAgICAgICAgICBpbnB1dF9kZXRhaWxzID0gewogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGlucHV0X3RhZy5nZXQoJ25hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiBpbnB1dF90YWcuZ2V0KCd0eXBlJywgJ3RleHQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogaW5wdXRfdGFnLmdldCgndmFsdWUnLCAnJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9ybV9kZXRhaWxzWydpbnB1dHMnXS5hcHBlbmQoaW5wdXRfZGV0YWlscykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9ybXMuYXBwZW5kKGZvcm1fZGV0YWlscykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBmb3JtcwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2coZiJFcnJvciBnZXR0aW5nIGZvcm1zIGZyb20ge3VybH06IHtzdHIoZSl9IiwgIkVSUk9SIikKICAgICAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIGdldF91cmxfcGFyYW1ldGVycyhzZWxmLCB1cmwpOgogICAgICAgICIiIkV4dHJhY3QgVVJMIHBhcmFtZXRlcnMgd2l0aCBlbmhhbmNlZCBkZXRlY3Rpb24iIiIKICAgICAgICBwYXJzZWRfdXJsID0gdXJscGFyc2UodXJsKQogICAgICAgIHBhcmFtcyA9IHBhcnNlX3FzKHBhcnNlZF91cmwucXVlcnkpCiAgICAgICAgCiAgICAgICAgIyBDb252ZXJ0IHRvIHNpbXBsZSBkaWN0CiAgICAgICAgcGFyYW1fZGljdCA9IHtrZXk6IHZhbHVlWzBdIGlmIHZhbHVlIGVsc2UgJycgZm9yIGtleSwgdmFsdWUgaW4gcGFyYW1zLml0ZW1zKCl9CiAgICAgICAgCiAgICAgICAgIyBJZiBubyBwYXJhbWV0ZXJzIGZvdW5kLCB0cnkgdG8gZGlzY292ZXIgcG90ZW50aWFsIGluamVjdGlvbiBwb2ludHMKICAgICAgICBpZiBub3QgcGFyYW1fZGljdDoKICAgICAgICAgICAgc2VsZi5sb2coIk5vIFVSTCBwYXJhbWV0ZXJzIGZvdW5kLCBjaGVja2luZyBmb3IgcG90ZW50aWFsIGluamVjdGlvbiBwb2ludHMuLi4iLCAiSU5GTyIpCiAgICAgICAgICAgIHBhcmFtX2RpY3QgPSBzZWxmLmRpc2NvdmVyX3BvdGVudGlhbF9wYXJhbWV0ZXJzKHVybCkKICAgICAgICAKICAgICAgICByZXR1cm4gcGFyYW1fZGljdAogICAgCiAgICBkZWYgZGlzY292ZXJfcG90ZW50aWFsX3BhcmFtZXRlcnMoc2VsZiwgdXJsKToKICAgICAgICAiIiJEaXNjb3ZlciBwb3RlbnRpYWwgcGFyYW1ldGVycyBmcm9tIGNvbW1vbiBwYXR0ZXJucyIiIgogICAgICAgIHBvdGVudGlhbF9wYXJhbXMgPSB7fQogICAgICAgIAogICAgICAgICMgQ29tbW9uIHBhcmFtZXRlciBuYW1lcyB0byB0ZXN0CiAgICAgICAgY29tbW9uX3BhcmFtcyA9IFsKICAgICAgICAgICAgJ2lkJywgJ3BhZ2UnLCAnc2VhcmNoJywgJ3EnLCAncXVlcnknLCAnbmFtZScsICd1c2VyJywgJ2NhdCcsICdjYXRlZ29yeScsCiAgICAgICAgICAgICd0eXBlJywgJ2FjdGlvbicsICd2aWV3JywgJ2ZpbGUnLCAncGF0aCcsICd1cmwnLCAncmVkaXJlY3QnLCAnbmV4dCcsCiAgICAgICAgICAgICdjYWxsYmFjaycsICdyZXR1cm4nLCAnZ290bycsICd0YXJnZXQnLCAnZGF0YScsICd2YWx1ZScsICdpbnB1dCcsCiAgICAgICAgICAgICd0ZXJtJywgJ2tleXdvcmQnLCAnZmlsdGVyJywgJ3NvcnQnLCAnb3JkZXInLCAnbGltaXQnLCAnb2Zmc2V0JwogICAgICAgIF0KICAgICAgICAKICAgICAgICAjIFRlc3QgaWYgVVJMIGFjY2VwdHMgcGFyYW1ldGVycyBieSBhZGRpbmcgdGVzdCBwYXJhbWV0ZXIKICAgICAgICBiYXNlX3VybCA9IHVybC5yc3RyaXAoJy8nKQogICAgICAgIAogICAgICAgIGZvciBwYXJhbSBpbiBjb21tb25fcGFyYW1zOgogICAgICAgICAgICB0ZXN0X3VybCA9IGYie2Jhc2VfdXJsfT97cGFyYW19PXRlc3QiCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5zZXNzaW9uLmdldCh0ZXN0X3VybCwgdGltZW91dD01KQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIHBhcmFtZXRlciBtaWdodCBiZSBwcm9jZXNzZWQKICAgICAgICAgICAgICAgICAgICBpZiAndGVzdCcgaW4gcmVzcG9uc2UudGV4dCBvciBwYXJhbSBpbiByZXNwb25zZS50ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxfcGFyYW1zW3BhcmFtXSA9ICd0ZXN0JwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhmIkRpc2NvdmVyZWQgcG90ZW50aWFsIHBhcmFtZXRlcjoge3BhcmFtfSIsICJJTkZPIikKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICByZXR1cm4gcG90ZW50aWFsX3BhcmFtcwoKICAgIGRlZiBkZXRlY3Rfd2FmKHNlbGYsIHVybCk6CiAgICAgICAgIiIiRGV0ZWN0IFdBRiBwcmVzZW50IG9uIHRoZSB0YXJnZXQgVVJMIiIiCiAgICAgICAgd2FmX2luZGljYXRvcnMgPSB7CiAgICAgICAgICAgICJDbG91ZGZsYXJlIjogWyJjbG91ZGZsYXJlIiwgImNmLXJheSIsICJfX2NmZHVpZCJdLAogICAgICAgICAgICAiQWthbWFpIjogWyJha2FtYWkiLCAiYWthbWFpLWdob3N0Il0sCiAgICAgICAgICAgICJJbXBlcnZhIChJbmNhcHN1bGEpIjogWyJpbmNhcHN1bGEiLCAiaW1wZXJ2YSIsICJ4LWlpbmZvIl0sCiAgICAgICAgICAgICJTdWN1cmkiOiBbInN1Y3VyaSIsICJ4LXN1Y3VyaS1pZCJdLAogICAgICAgICAgICAiRjUgQklHLUlQIjogWyJmNSIsICJiaWdpcCIsICJ4LXdhZi1ldmVudCJdLAogICAgICAgICAgICAiTW9kU2VjdXJpdHkiOiBbIm1vZF9zZWN1cml0eSIsICJtb2RzZWN1cml0eSJdLAogICAgICAgICAgICAiQVdTIFdBRiI6IFsiYXdzd2FmIiwgIngtYW16bi1yZXF1ZXN0aWQiXSwKICAgICAgICAgICAgIkJhcnJhY3VkYSI6IFsiYmFycmFjdWRhIiwgImJhcnJhIl0sCiAgICAgICAgICAgICJGb3J0aW5ldCI6IFsiZm9ydGluZXQiLCAiZm9ydGlnYXRlIl0KICAgICAgICB9CgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnNlc3Npb24uZ2V0KHVybCwgdGltZW91dD01KQogICAgICAgICAgICBoZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycwogICAgICAgICAgICBjb250ZW50ID0gcmVzcG9uc2UudGV4dC5sb3dlcigpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3Igd2FmX25hbWUsIGluZGljYXRvcnMgaW4gd2FmX2luZGljYXRvcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBpbmRpY2F0b3IgaW4gaW5kaWNhdG9yczoKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGhlYWRlcnMKICAgICAgICAgICAgICAgICAgICBmb3IgaGVhZGVyX25hbWUsIGhlYWRlcl92YWx1ZSBpbiBoZWFkZXJzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGluZGljYXRvci5sb3dlcigpIGluIGhlYWRlcl9uYW1lLmxvd2VyKCkgb3IgaW5kaWNhdG9yLmxvd2VyKCkgaW4gaGVhZGVyX3ZhbHVlLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2FmX25hbWUKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICBpZiBpbmRpY2F0b3IgaW4gY29udGVudDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdhZl9uYW1lCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBlbmNvZGVfcGF5bG9hZChzZWxmLCBwYXlsb2FkLCBlbmNvZGluZ190eXBlPSdub25lJyk6CiAgICAgICAgIiIiRW5jb2RlIHBheWxvYWQgd2l0aCBkaWZmZXJlbnQgZW5jb2RpbmcgbWV0aG9kcyIiIgogICAgICAgIGlmIGVuY29kaW5nX3R5cGUgPT0gJ3VybCc6CiAgICAgICAgICAgIHJldHVybiBxdW90ZShwYXlsb2FkLCBzYWZlPScnKQogICAgICAgIGVsaWYgZW5jb2RpbmdfdHlwZSA9PSAnZG91YmxlX3VybCc6CiAgICAgICAgICAgIHJldHVybiBxdW90ZShxdW90ZShwYXlsb2FkLCBzYWZlPScnKSwgc2FmZT0nJykKICAgICAgICBlbGlmIGVuY29kaW5nX3R5cGUgPT0gJ2h0bWwnOgogICAgICAgICAgICByZXR1cm4gaHRtbC5lc2NhcGUocGF5bG9hZCkKICAgICAgICBlbGlmIGVuY29kaW5nX3R5cGUgPT0gJ2Jhc2U2NCc6CiAgICAgICAgICAgIHJldHVybiBiYXNlNjQuYjY0ZW5jb2RlKHBheWxvYWQuZW5jb2RlKCkpLmRlY29kZSgpCiAgICAgICAgZWxpZiBlbmNvZGluZ190eXBlID09ICdoZXgnOgogICAgICAgICAgICByZXR1cm4gJycuam9pbihmJyV7b3JkKGMpOjAyeH0nIGZvciBjIGluIHBheWxvYWQpCiAgICAgICAgZWxpZiBlbmNvZGluZ190eXBlID09ICd1bmljb2RlJzoKICAgICAgICAgICAgcmV0dXJuICcnLmpvaW4oZidcXHV7b3JkKGMpOjA0eH0nIGZvciBjIGluIHBheWxvYWQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQKICAgIAogICAgZGVmIHRlc3RfcmVmbGVjdGlvbihzZWxmLCB1cmwsIG1ldGhvZD0nR0VUJywgZGF0YT1Ob25lLCBwYXJhbV9uYW1lPU5vbmUpOgogICAgICAgICIiIlRlc3QgaWYgcGF5bG9hZCBpcyByZWZsZWN0ZWQgaW4gcmVzcG9uc2Ugd2l0aCBlbmhhbmNlZCBkZXRlY3Rpb24iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG1ldGhvZC51cHBlcigpID09ICdHRVQnOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnNlc3Npb24uZ2V0KHVybCwgdGltZW91dD0xMCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5zZXNzaW9uLnBvc3QodXJsLCBkYXRhPWRhdGEsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnLCAnJykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nKGYiRXJyb3IgdGVzdGluZyByZWZsZWN0aW9uOiB7c3RyKGUpfSIsICJFUlJPUiIpCiAgICAgICAgICAgIHJldHVybiAiIiwgMCwgIiIKCiAgICBkZWYgdGVzdF94c3NfaW5fdXJsKHNlbGYsIHVybCk6CiAgICAgICAgIiIiVGVzdCBYU1MgaW4gVVJMIHBhcmFtZXRlcnMgd2l0aCBtdWx0aXBsZSBwYXlsb2FkcyBhbmQgZW5jb2RpbmdzIiIiCiAgICAgICAgcGFyYW1zID0gc2VsZi5nZXRfdXJsX3BhcmFtZXRlcnModXJsKQogICAgICAgIGlmIG5vdCBwYXJhbXM6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHBhcnNlZF91cmwgPSB1cmxwYXJzZSh1cmwpCiAgICAgICAgYmFzZV91cmwgPSBmIntwYXJzZWRfdXJsLnNjaGVtZX06Ly97cGFyc2VkX3VybC5uZXRsb2N9e3BhcnNlZF91cmwucGF0aH0iCiAgICAgICAgCiAgICAgICAgZm9yIHBhcmFtX25hbWUgaW4gcGFyYW1zLmtleXMoKToKICAgICAgICAgICAgc2VsZi5sb2coZiJUZXN0aW5nIFVSTCBwYXJhbWV0ZXI6IHtwYXJhbV9uYW1lfSIsICJJTkZPIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGVzdCBhbGwgcGF5bG9hZHMgZm9yIHRoaXMgcGFyYW1ldGVyCiAgICAgICAgICAgIGZvciBvcmlnaW5hbF9wYXlsb2FkIGluIHNlbGYucGF5bG9hZHM6CiAgICAgICAgICAgICAgICB1bmlxdWVfaWQgPSBmIlhTU3tyYW5kb20ucmFuZGludCgxMDAwLCA5OTk5KX0iCiAgICAgICAgICAgICAgICB0ZXN0X3BheWxvYWQgPSBvcmlnaW5hbF9wYXlsb2FkLnJlcGxhY2UoJ1hTUycsIHVuaXF1ZV9pZCkucmVwbGFjZSgnYWxlcnQoIlhTUyIpJywgZidhbGVydCgie3VuaXF1ZV9pZH0iKScpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGVzdCB3aXRoIGRpZmZlcmVudCBlbmNvZGluZ3MKICAgICAgICAgICAgICAgIGVuY29kaW5ncyA9IFsnbm9uZScsICd1cmwnLCAnZG91YmxlX3VybCcsICdodG1sJ10KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGVuY29kaW5nIGluIGVuY29kaW5nczoKICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX3BheWxvYWQgPSBzZWxmLmVuY29kZV9wYXlsb2FkKHRlc3RfcGF5bG9hZCwgZW5jb2RpbmcpCiAgICAgICAgICAgICAgICAgICAgdGVzdF9wYXJhbXMgPSBwYXJhbXMuY29weSgpCiAgICAgICAgICAgICAgICAgICAgdGVzdF9wYXJhbXNbcGFyYW1fbmFtZV0gPSBlbmNvZGVkX3BheWxvYWQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0ZXN0X3VybCA9IGYie2Jhc2VfdXJsfT97dXJsZW5jb2RlKHRlc3RfcGFyYW1zKX0iCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfdGV4dCwgc3RhdHVzX2NvZGUsIGNvbnRlbnRfdHlwZSA9IHNlbGYudGVzdF9yZWZsZWN0aW9uKHRlc3RfdXJsKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgRW5oYW5jZWQgcmVmbGVjdGlvbiBkZXRlY3Rpb24KICAgICAgICAgICAgICAgICAgICBpZiBzdGF0dXNfY29kZSA9PSAyMDAgYW5kIHNlbGYuaXNfeHNzX3JlZmxlY3RlZChyZXNwb25zZV90ZXh0LCB1bmlxdWVfaWQsIGNvbnRlbnRfdHlwZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQnJvd3NlciB2ZXJpZmljYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3ZlcmlmaWVkID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYnJvd3Nlcl92ZXJpZnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfdmVyaWZpZWQgPSBzZWxmLnZlcmlmeV94c3NfaW5fYnJvd3Nlcih0ZXN0X3VybCwgdGVzdF9wYXlsb2FkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc192ZXJpZmllZCBvciBub3Qgc2VsZi5icm93c2VyX3ZlcmlmeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2dWxuID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdSZWZsZWN0ZWQgWFNTJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHRlc3RfdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFyYW1ldGVyJzogcGFyYW1fbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheWxvYWQnOiBvcmlnaW5hbF9wYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZW5jb2RlZF9wYXlsb2FkJzogZW5jb2RlZF9wYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZW5jb2RpbmcnOiBlbmNvZGluZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCc6ICdHRVQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pcXVlX2lkJzogdW5pcXVlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudF90eXBlJzogY29udGVudF90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmVyaWZpZWRfaW5fYnJvd3Nlcic6IGlzX3ZlcmlmaWVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudnVsbmVyYWJpbGl0aWVzLmFwcGVuZCh2dWxuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGYiVlVMTkVSQUJJTElUWSBGT1VORCEgUGFyYW1ldGVyOiB7cGFyYW1fbmFtZX0sIEVuY29kaW5nOiB7ZW5jb2Rpbmd9LCBQYXlsb2FkOiB7b3JpZ2luYWxfcGF5bG9hZFs6NTBdfS4uLiIsICJWVUxOIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc192ZXJpZmllZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coIlBheWxvYWQgZXhlY3V0aW9uIFZFUklGSUVEIGluIGJyb3dzZXIhIiwgIlNVQ0NFU1MiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIEZvdW5kIHdvcmtpbmcgcGF5bG9hZCwgbW92ZSB0byBuZXh0IHBheWxvYWQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmRlbGF5OgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHNlbGYuZGVsYXkpCgogICAgZGVmIGlzX3hzc19yZWZsZWN0ZWQoc2VsZiwgcmVzcG9uc2VfdGV4dCwgdW5pcXVlX2lkLCBjb250ZW50X3R5cGUpOgogICAgICAgICIiIkVuaGFuY2VkIFhTUyByZWZsZWN0aW9uIGRldGVjdGlvbiB0byBhdm9pZCBmYWxzZSBwb3NpdGl2ZXMiIiIKICAgICAgICBpZiB1bmlxdWVfaWQgbm90IGluIHJlc3BvbnNlX3RleHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgICMgQ2hlY2sgaWYgaXQncyBpbiBhIGNvbnRleHQgd2hlcmUgWFNTIHdvdWxkIGV4ZWN1dGUKICAgICAgICBkYW5nZXJvdXNfY29udGV4dHMgPSBbCiAgICAgICAgICAgIGYnPHNjcmlwdD57dW5pcXVlX2lkfScsCiAgICAgICAgICAgIGYnPHNjcmlwdD5hbGVydCgie3VuaXF1ZV9pZH0iKScsCiAgICAgICAgICAgIGYnb25lcnJvcj1hbGVydCgie3VuaXF1ZV9pZH0iKScsCiAgICAgICAgICAgIGYnb25sb2FkPWFsZXJ0KCJ7dW5pcXVlX2lkfSIpJywKICAgICAgICAgICAgZidqYXZhc2NyaXB0OmFsZXJ0KCJ7dW5pcXVlX2lkfSIpJywKICAgICAgICAgICAgZic8c3ZnIG9ubG9hZD1hbGVydCgie3VuaXF1ZV9pZH0iKScsCiAgICAgICAgICAgIGYnPGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KCJ7dW5pcXVlX2lkfSIpJywKICAgICAgICAgICAgZic8Ym9keSBvbmxvYWQ9YWxlcnQoInt1bmlxdWVfaWR9IiknLAogICAgICAgICAgICBmJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OmFsZXJ0KCJ7dW5pcXVlX2lkfSIpJywKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgIyBDaGVjayBmb3IgZGFuZ2Vyb3VzIGNvbnRleHRzCiAgICAgICAgZm9yIGNvbnRleHQgaW4gZGFuZ2Vyb3VzX2NvbnRleHRzOgogICAgICAgICAgICBpZiBjb250ZXh0IGluIHJlc3BvbnNlX3RleHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgICAgICMgQ2hlY2sgaWYgcmVmbGVjdGVkIGluIEhUTUwgY29udGVudCAobm90IGp1c3QgcGxhaW4gdGV4dCkKICAgICAgICBpZiAndGV4dC9odG1sJyBpbiBjb250ZW50X3R5cGUubG93ZXIoKToKICAgICAgICAgICAgIyBMb29rIGZvciBIVE1MIHRhZ3MgY29udGFpbmluZyB0aGUgdW5pcXVlX2lkCiAgICAgICAgICAgIGh0bWxfcGF0dGVybiA9IGYnPFtePl0qe3JlLmVzY2FwZSh1bmlxdWVfaWQpfVtePl0qPicKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKGh0bWxfcGF0dGVybiwgcmVzcG9uc2VfdGV4dCwgcmUuSUdOT1JFQ0FTRSk6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgICAgICMgQWRkaXRpb25hbCBjaGVjayBmb3Igc2NyaXB0IGNvbnRleHQKICAgICAgICBzY3JpcHRfcGF0dGVybiA9IGYnPHNjcmlwdFtePl0qPltePF0qe3JlLmVzY2FwZSh1bmlxdWVfaWQpfVtePF0qPC9zY3JpcHQ+JwogICAgICAgIGlmIHJlLnNlYXJjaChzY3JpcHRfcGF0dGVybiwgcmVzcG9uc2VfdGV4dCwgcmUuSUdOT1JFQ0FTRSk6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiB0ZXN0X3hzc19pbl9mb3JtcyhzZWxmLCB1cmwpOgogICAgICAgICIiIlRlc3QgWFNTIGluIGZvcm0gaW5wdXRzIHdpdGggbXVsdGlwbGUgcGF5bG9hZHMgYW5kIGVuY29kaW5ncyIiIgogICAgICAgIGZvcm1zID0gc2VsZi5nZXRfZm9ybXModXJsKQogICAgICAgIAogICAgICAgIGZvciBmb3JtIGluIGZvcm1zOgogICAgICAgICAgICBhY3Rpb24gPSBmb3JtWydhY3Rpb24nXQogICAgICAgICAgICBtZXRob2QgPSBmb3JtWydtZXRob2QnXQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYWN0aW9uOgogICAgICAgICAgICAgICAgaWYgYWN0aW9uLnN0YXJ0c3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICBhY3Rpb25fdXJsID0gdXJsam9pbih1cmwsIGFjdGlvbikKICAgICAgICAgICAgICAgIGVsaWYgYWN0aW9uLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICBhY3Rpb25fdXJsID0gYWN0aW9uCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFjdGlvbl91cmwgPSB1cmxqb2luKHVybCwgYWN0aW9uKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWN0aW9uX3VybCA9IHVybAogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2coZiJUZXN0aW5nIGZvcm06IHthY3Rpb25fdXJsfSAoe21ldGhvZC51cHBlcigpfSkiLCAiSU5GTyIpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgaW5wdXRfZmllbGQgaW4gZm9ybVsnaW5wdXRzJ106CiAgICAgICAgICAgICAgICBpbnB1dF9uYW1lID0gaW5wdXRfZmllbGRbJ25hbWUnXQogICAgICAgICAgICAgICAgaWYgbm90IGlucHV0X25hbWU6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2coZiJUZXN0aW5nIGZvcm0gaW5wdXQ6IHtpbnB1dF9uYW1lfSIsICJJTkZPIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBUZXN0IGFsbCBwYXlsb2FkcyBmb3IgdGhpcyBpbnB1dAogICAgICAgICAgICAgICAgZm9yIG9yaWdpbmFsX3BheWxvYWQgaW4gc2VsZi5wYXlsb2FkczoKICAgICAgICAgICAgICAgICAgICB1bmlxdWVfaWQgPSBmIlhTU3tyYW5kb20ucmFuZGludCgxMDAwLCA5OTk5KX0iCiAgICAgICAgICAgICAgICAgICAgdGVzdF9wYXlsb2FkID0gb3JpZ2luYWxfcGF5bG9hZC5yZXBsYWNlKCdYU1MnLCB1bmlxdWVfaWQpLnJlcGxhY2UoJ2FsZXJ0KCJYU1MiKScsIGYnYWxlcnQoInt1bmlxdWVfaWR9IiknKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVGVzdCB3aXRoIGRpZmZlcmVudCBlbmNvZGluZ3MKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZ3MgPSBbJ25vbmUnLCAndXJsJywgJ2RvdWJsZV91cmwnLCAnaHRtbCddCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIGVuY29kaW5nIGluIGVuY29kaW5nczoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RlZF9wYXlsb2FkID0gc2VsZi5lbmNvZGVfcGF5bG9hZCh0ZXN0X3BheWxvYWQsIGVuY29kaW5nKQogICAgICAgICAgICAgICAgICAgICAgICBmb3JtX2RhdGEgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBGaWxsIGZvcm0gd2l0aCBkZWZhdWx0IHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZmllbGQgaW4gZm9ybVsnaW5wdXRzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmaWVsZFsnbmFtZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZpZWxkWyduYW1lJ10gPT0gaW5wdXRfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9kYXRhW2ZpZWxkWyduYW1lJ11dID0gZW5jb2RlZF9wYXlsb2FkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9kYXRhW2ZpZWxkWyduYW1lJ11dID0gZmllbGRbJ3ZhbHVlJ10gb3IgJ3Rlc3QnCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZV90ZXh0LCBzdGF0dXNfY29kZSwgY29udGVudF90eXBlID0gc2VsZi50ZXN0X3JlZmxlY3Rpb24oYWN0aW9uX3VybCwgbWV0aG9kLCBmb3JtX2RhdGEsIGlucHV0X25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEVuaGFuY2VkIHJlZmxlY3Rpb24gZGV0ZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXR1c19jb2RlID09IDIwMCBhbmQgc2VsZi5pc194c3NfcmVmbGVjdGVkKHJlc3BvbnNlX3RleHQsIHVuaXF1ZV9pZCwgY29udGVudF90eXBlKToKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEJyb3dzZXIgdmVyaWZpY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc192ZXJpZmllZCA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmJyb3dzZXJfdmVyaWZ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX3ZlcmlmaWVkID0gc2VsZi52ZXJpZnlfeHNzX2luX2Jyb3dzZXIoYWN0aW9uX3VybCwgZm9ybV9kYXRhKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzX3ZlcmlmaWVkIG9yIG5vdCBzZWxmLmJyb3dzZXJfdmVyaWZ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZ1bG4gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ1JlZmxlY3RlZCBYU1MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogYWN0aW9uX3VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcmFtZXRlcic6IGlucHV0X25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXlsb2FkJzogb3JpZ2luYWxfcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VuY29kZWRfcGF5bG9hZCc6IGVuY29kZWRfcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VuY29kaW5nJzogZW5jb2RpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnOiBtZXRob2QudXBwZXIoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXF1ZV9pZCc6IHVuaXF1ZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnRfdHlwZSc6IGNvbnRlbnRfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlcmlmaWVkX2luX2Jyb3dzZXInOiBpc192ZXJpZmllZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnZ1bG5lcmFiaWxpdGllcy5hcHBlbmQodnVsbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZyhmIlZVTE5FUkFCSUxJVFkgRk9VTkQhIEZvcm0gaW5wdXQ6IHtpbnB1dF9uYW1lfSwgRW5jb2Rpbmc6IHtlbmNvZGluZ30sIFBheWxvYWQ6IHtvcmlnaW5hbF9wYXlsb2FkWzo1MF19Li4uIiwgIlZVTE4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzX3ZlcmlmaWVkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZygiUGF5bG9hZCBleGVjdXRpb24gVkVSSUZJRUQgaW4gYnJvd3NlciEiLCAiU1VDQ0VTUyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgICMgRm91bmQgd29ya2luZyBwYXlsb2FkLCBtb3ZlIHRvIG5leHQgcGF5bG9hZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5kZWxheToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoc2VsZi5kZWxheSkKCiAgICBkZWYgY3Jhd2xfbGlua3Moc2VsZiwgdXJsLCBtYXhfZGVwdGg9MiwgY3VycmVudF9kZXB0aD0wKToKICAgICAgICAiIiJDcmF3bCB3ZWJzaXRlIHRvIGZpbmQgbW9yZSBVUkxzIHRvIHRlc3QiIiIKICAgICAgICBpZiBjdXJyZW50X2RlcHRoID49IG1heF9kZXB0aCBvciB1cmwgaW4gc2VsZi50ZXN0ZWRfdXJsczoKICAgICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgCiAgICAgICAgc2VsZi50ZXN0ZWRfdXJscy5hZGQodXJsKQogICAgICAgIGxpbmtzID0gW3VybF0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5zZXNzaW9uLmdldCh1cmwsIHRpbWVvdXQ9MTApCiAgICAgICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKHJlc3BvbnNlLmNvbnRlbnQsICdodG1sLnBhcnNlcicpCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgbGluayBpbiBzb3VwLmZpbmRfYWxsKCdhJywgaHJlZj1UcnVlKToKICAgICAgICAgICAgICAgIGhyZWYgPSBsaW5rWydocmVmJ10KICAgICAgICAgICAgICAgIGZ1bGxfdXJsID0gdXJsam9pbih1cmwsIGhyZWYpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgT25seSBjcmF3bCBzYW1lIGRvbWFpbgogICAgICAgICAgICAgICAgaWYgdXJscGFyc2UoZnVsbF91cmwpLm5ldGxvYyA9PSB1cmxwYXJzZSh1cmwpLm5ldGxvYzoKICAgICAgICAgICAgICAgICAgICBpZiBmdWxsX3VybCBub3QgaW4gc2VsZi50ZXN0ZWRfdXJsczoKICAgICAgICAgICAgICAgICAgICAgICAgbGlua3MuZXh0ZW5kKHNlbGYuY3Jhd2xfbGlua3MoZnVsbF91cmwsIG1heF9kZXB0aCwgY3VycmVudF9kZXB0aCArIDEpKQogICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2coZiJFcnJvciBjcmF3bGluZyB7dXJsfToge3N0cihlKX0iLCAiRVJST1IiKQogICAgICAgIAogICAgICAgIHJldHVybiBsaW5rcwoKICAgIGRlZiB0ZXN0X2RvbV94c3Moc2VsZiwgdXJsKToKICAgICAgICAiIiJUZXN0IGZvciBET00tYmFzZWQgWFNTIHZ1bG5lcmFiaWxpdGllcyIiIgogICAgICAgIGRvbV9wYXlsb2FkcyA9IFsKICAgICAgICAgICAgJyM8c2NyaXB0PmFsZXJ0KCJET01fWFNTIik8L3NjcmlwdD4nLAogICAgICAgICAgICAnIyI+PHNjcmlwdD5hbGVydCgiRE9NX1hTUyIpPC9zY3JpcHQ+JywKICAgICAgICAgICAgJyNqYXZhc2NyaXB0OmFsZXJ0KCJET01fWFNTIiknLAogICAgICAgICAgICAnIzxpbWcgc3JjPXggb25lcnJvcj1hbGVydCgiRE9NX1hTUyIpPicsCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBwYXlsb2FkIGluIGRvbV9wYXlsb2FkczoKICAgICAgICAgICAgdGVzdF91cmwgPSB1cmwgKyBwYXlsb2FkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5zZXNzaW9uLmdldCh0ZXN0X3VybCwgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIGlmICJET01fWFNTIiBpbiByZXNwb25zZS50ZXh0OgogICAgICAgICAgICAgICAgICAgIHZ1bG4gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ0RPTSBYU1MnLAogICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogdGVzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXJhbWV0ZXInOiAnVVJMIEZyYWdtZW50JywKICAgICAgICAgICAgICAgICAgICAgICAgJ3BheWxvYWQnOiBwYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJzogJ0dFVCcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2VsZi52dWxuZXJhYmlsaXRpZXMuYXBwZW5kKHZ1bG4pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2coZiJET00gWFNTIFZVTE5FUkFCSUxJVFkgRk9VTkQhIFBheWxvYWQ6IHtwYXlsb2FkfSIsICJWVUxOIikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgc2VsZi5sb2coZiJFcnJvciB0ZXN0aW5nIERPTSBYU1M6IHtzdHIoZSl9IiwgIkVSUk9SIikKCiAgICBkZWYgc2Nhbl9zaW5nbGVfdXJsKHNlbGYsIHVybCk6CiAgICAgICAgIiIiU2NhbiBhIHNpbmdsZSBVUkwgZm9yIFhTUyB2dWxuZXJhYmlsaXRpZXMgd2l0aCBXQUYgYXdhcmVuZXNzIiIiCiAgICAgICAgc2VsZi5sb2coZiJTY2FubmluZyBVUkw6IHt1cmx9IiwgIklORk8iKQogICAgICAgIAogICAgICAgICMgRGV0ZWN0IFdBRiBhdCB0aGUgYmVnaW5uaW5nIG9mIHNjYW4KICAgICAgICBpZiBub3Qgc2VsZi5kZXRlY3RlZF93YWY6CiAgICAgICAgICAgIHNlbGYuZGV0ZWN0ZWRfd2FmID0gc2VsZi5kZXRlY3Rfd2FmKHVybCkKICAgICAgICAgICAgaWYgc2VsZi5kZXRlY3RlZF93YWY6CiAgICAgICAgICAgICAgICBzZWxmLmxvZyhmIldBRiBEZXRlY3RlZDoge3NlbGYuZGV0ZWN0ZWRfd2FmfSIsICJXQVJOSU5HIikKICAgICAgICAgICAgICAgICMgUHJlcGVuZCBXQUYtc3BlY2lmaWMgYnlwYXNzIHBheWxvYWRzCiAgICAgICAgICAgICAgICBieXBhc3NfcGF5bG9hZHMgPSBzZWxmLmdldF93YWZfYnlwYXNzX3BheWxvYWRzKHNlbGYuZGV0ZWN0ZWRfd2FmKQogICAgICAgICAgICAgICAgaWYgYnlwYXNzX3BheWxvYWRzOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nKGYiTG9hZGluZyB7bGVuKGJ5cGFzc19wYXlsb2Fkcyl9IGJ5cGFzcyBwYXlsb2FkcyBmb3Ige3NlbGYuZGV0ZWN0ZWRfd2FmfSIsICJJTkZPIikKICAgICAgICAgICAgICAgICAgICBzZWxmLnBheWxvYWRzID0gYnlwYXNzX3BheWxvYWRzICsgc2VsZi5wYXlsb2FkcwogICAgICAgIAogICAgICAgICMgVGVzdCBVUkwgcGFyYW1ldGVycwogICAgICAgIHNlbGYudGVzdF94c3NfaW5fdXJsKHVybCkKICAgICAgICAKICAgICAgICAjIFRlc3QgZm9ybXMKICAgICAgICBzZWxmLnRlc3RfeHNzX2luX2Zvcm1zKHVybCkKICAgICAgICAKICAgICAgICAjIFRlc3QgRE9NIFhTUwogICAgICAgIHNlbGYudGVzdF9kb21feHNzKHVybCkKCiAgICBkZWYgc2NhbihzZWxmLCBjcmF3bD1GYWxzZSwgbWF4X2RlcHRoPTIpOgogICAgICAgICIiIk1haW4gc2Nhbm5pbmcgZnVuY3Rpb24iIiIKICAgICAgICBzZWxmLmxvZygiU3RhcnRpbmcgWFNTIHNjYW4uLi4iLCAiSU5GTyIpCiAgICAgICAgCiAgICAgICAgdXJsc190b190ZXN0ID0gW3NlbGYudGFyZ2V0X3VybF0KICAgICAgICAKICAgICAgICBpZiBjcmF3bDoKICAgICAgICAgICAgc2VsZi5sb2coIkNyYXdsaW5nIHdlYnNpdGUgZm9yIGFkZGl0aW9uYWwgVVJMcy4uLiIsICJJTkZPIikKICAgICAgICAgICAgdXJsc190b190ZXN0ID0gc2VsZi5jcmF3bF9saW5rcyhzZWxmLnRhcmdldF91cmwsIG1heF9kZXB0aCkKICAgICAgICAgICAgc2VsZi5sb2coZiJGb3VuZCB7bGVuKHVybHNfdG9fdGVzdCl9IFVSTHMgdG8gdGVzdCIsICJJTkZPIikKICAgICAgICAKICAgICAgICAjIFVzZSB0aHJlYWRpbmcgZm9yIGZhc3RlciBzY2FubmluZwogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPXNlbGYudGhyZWFkcykgYXMgZXhlY3V0b3I6CiAgICAgICAgICAgIGV4ZWN1dG9yLm1hcChzZWxmLnNjYW5fc2luZ2xlX3VybCwgdXJsc190b190ZXN0KQogICAgICAgIAogICAgICAgIHNlbGYuZ2VuZXJhdGVfcmVwb3J0KCkKCiAgICBkZWYgZ2VuZXJhdGVfcmVwb3J0KHNlbGYpOgogICAgICAgICIiIkdlbmVyYXRlIGNvbXByZWhlbnNpdmUgc2NhbiByZXBvcnQiIiIKICAgICAgICBwcmludCgiXG4iICsgIj0iKjYwKQogICAgICAgIHByaW50KGYie0ZvcmUuTUFHRU5UQX1YU1MgU0NBTiBSRVBPUlQgLSBDcmFmdGVkIGJ5IEg0bXphWCIpCiAgICAgICAgcHJpbnQoIj0iKjYwKQogICAgICAgIAogICAgICAgICMgRGV0ZWN0IFdBRiBpZiBhdmFpbGFibGUKICAgICAgICB3YWZfZGV0YWlscyA9IHNlbGYuZGV0ZWN0X3dhZihzZWxmLnRhcmdldF91cmwpCiAgICAgICAgaWYgd2FmX2RldGFpbHM6CiAgICAgICAgICAgIHByaW50KGYie0ZvcmUuWUVMTE9XfVdBRiBEZXRlY3RlZDoge3dhZl9kZXRhaWxzfXtTdHlsZS5SRVNFVF9BTEx9IikKICAgICAgICAKICAgICAgICBpZiBub3Qgc2VsZi52dWxuZXJhYmlsaXRpZXM6CiAgICAgICAgICAgIHByaW50KGYie0ZvcmUuR1JFRU59Tm8gWFNTIHZ1bG5lcmFiaWxpdGllcyBmb3VuZC4iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie0ZvcmUuUkVEfUZvdW5kIHtsZW4oc2VsZi52dWxuZXJhYmlsaXRpZXMpfSBYU1MgdnVsbmVyYWJpbGl0aWVzOiIpCiAgICAgICAgICAgIHByaW50KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBpLCB2dWxuIGluIGVudW1lcmF0ZShzZWxmLnZ1bG5lcmFiaWxpdGllcywgMSk6CiAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLlJFRH1be2l9XSB7dnVsblsndHlwZSddfSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBVUkw6IHt2dWxuWyd1cmwnXX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgUGFyYW1ldGVyOiB7dnVsblsncGFyYW1ldGVyJ119IikKICAgICAgICAgICAgICAgIHByaW50KGYiICAgIE1ldGhvZDoge3Z1bG5bJ21ldGhvZCddfSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgICBQYXlsb2FkOiB7dnVsblsncGF5bG9hZCddfSIpCiAgICAgICAgICAgICAgICBpZiAnZW5jb2RpbmcnIGluIHZ1bG46CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgRW5jb2Rpbmc6IHt2dWxuWydlbmNvZGluZyddfSIpCiAgICAgICAgICAgICAgICBpZiAnY29udGVudF90eXBlJyBpbiB2dWxuOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIENvbnRlbnQtVHlwZToge3Z1bG5bJ2NvbnRlbnRfdHlwZSddfSIpCiAgICAgICAgICAgICAgICBwcmludCgpCiAgICAgICAgCiAgICAgICAgIyBTYXZlIGNvbXByZWhlbnNpdmUgcmVwb3J0IHRvIHNpbmdsZSBKU09OIGZpbGUKICAgICAgICByZXBvcnRfZGF0YSA9IHsKICAgICAgICAgICAgJ3NjYW5faW5mbyc6IHsKICAgICAgICAgICAgICAgICd0YXJnZXRfdXJsJzogc2VsZi50YXJnZXRfdXJsLAogICAgICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IHRpbWUuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyksCiAgICAgICAgICAgICAgICAndG90YWxfdnVsbmVyYWJpbGl0aWVzJzogbGVuKHNlbGYudnVsbmVyYWJpbGl0aWVzKSwKICAgICAgICAgICAgICAgICdzY2FuX3NldHRpbmdzJzogewogICAgICAgICAgICAgICAgICAgICd0aHJlYWRzJzogc2VsZi50aHJlYWRzLAogICAgICAgICAgICAgICAgICAgICdkZWxheSc6IHNlbGYuZGVsYXksCiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX3BheWxvYWRzX3Rlc3RlZCc6IGxlbihzZWxmLnBheWxvYWRzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAndnVsbmVyYWJpbGl0aWVzJzogc2VsZi52dWxuZXJhYmlsaXRpZXMKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHNlbGYub3V0cHV0X2ZpbGUsICd3JykgYXMgZjoKICAgICAgICAgICAganNvbi5kdW1wKHJlcG9ydF9kYXRhLCBmLCBpbmRlbnQ9MikKICAgICAgICAKICAgICAgICBwcmludChmIkNvbXByZWhlbnNpdmUgcmVwb3J0IHNhdmVkIHRvOiB7c2VsZi5vdXRwdXRfZmlsZX0iKQoKZGVmIHNjYW5fZnJvbV9maWxlKGFyZ3MpOgogICAgIiIiIFNjYW4gVVJMcyBmcm9tIGEgdHh0IGZpbGUgYW5kIHNhdmUgYWxsIHJlc3VsdHMgdG8gb25lIGZpbGUgIiIiCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGFyZ3MubGlzdCwgJ3InKSBhcyBmaWxlOgogICAgICAgICAgICB1cmxzID0gZmlsZS5yZWFkbGluZXMoKQogICAgICAgIAogICAgICAgIGFsbF92dWxuZXJhYmlsaXRpZXMgPSBbXQogICAgICAgIG91dHB1dF9maWxlID0gYXJncy5vdXRwdXQgb3IgZiJ4c3Nfc2Nhbl9yZXN1bHRzX2JhdGNoX3tpbnQodGltZS50aW1lKCkpfS5qc29uIgogICAgICAgIAogICAgICAgIGZvciB1cmwgaW4gdXJsczoKICAgICAgICAgICAgdXJsID0gdXJsLnN0cmlwKCkKICAgICAgICAgICAgaWYgdXJsOgogICAgICAgICAgICAgICAgcHJpbnQoZiJTdGFydGluZyBzY2FuIGZvcjoge3VybH0iKQogICAgICAgICAgICAgICAgc2Nhbm5lciA9IFhTU1NjYW5uZXIoCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3VybD11cmwsCiAgICAgICAgICAgICAgICAgICAgdGhyZWFkcz1hcmdzLnRocmVhZHMsCiAgICAgICAgICAgICAgICAgICAgZGVsYXk9YXJncy5kZWxheSwKICAgICAgICAgICAgICAgICAgICB2ZXJib3NlPWFyZ3MudmVyYm9zZSwKICAgICAgICAgICAgICAgICAgICB1c2VyX2FnZW50PWFyZ3MudXNlcl9hZ2VudCwKICAgICAgICAgICAgICAgICAgICBvdXRwdXRfZmlsZT1vdXRwdXRfZmlsZSwKICAgICAgICAgICAgICAgICAgICBicm93c2VyX3ZlcmlmeT1hcmdzLmJyb3dzZXJfdmVyaWZ5CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBzY2FubmVyLnNjYW4oY3Jhd2w9YXJncy5jcmF3bCwgbWF4X2RlcHRoPWFyZ3MubWF4X2RlcHRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENvbGxlY3QgdnVsbmVyYWJpbGl0aWVzIGZvciBiYXRjaCByZXBvcnQKICAgICAgICAgICAgICAgIGFsbF92dWxuZXJhYmlsaXRpZXMuZXh0ZW5kKHNjYW5uZXIudnVsbmVyYWJpbGl0aWVzKQogICAgICAgIAogICAgICAgICMgR2VuZXJhdGUgY29tYmluZWQgcmVwb3J0CiAgICAgICAgY29tYmluZWRfcmVwb3J0ID0gewogICAgICAgICAgICAnc2Nhbl9pbmZvJzogewogICAgICAgICAgICAgICAgJ2JhdGNoX3NjYW4nOiBUcnVlLAogICAgICAgICAgICAgICAgJ3RvdGFsX3VybHNfc2Nhbm5lZCc6IGxlbihbdS5zdHJpcCgpIGZvciB1IGluIHVybHMgaWYgdS5zdHJpcCgpXSksCiAgICAgICAgICAgICAgICAndGltZXN0YW1wJzogdGltZS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKSwKICAgICAgICAgICAgICAgICd0b3RhbF92dWxuZXJhYmlsaXRpZXMnOiBsZW4oYWxsX3Z1bG5lcmFiaWxpdGllcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ3Z1bG5lcmFiaWxpdGllcyc6IGFsbF92dWxuZXJhYmlsaXRpZXMKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9maWxlLCAndycpIGFzIGY6CiAgICAgICAgICAgIGpzb24uZHVtcChjb21iaW5lZF9yZXBvcnQsIGYsIGluZGVudD0yKQogICAgICAgIAogICAgICAgIHByaW50KGYiXG57Rm9yZS5HUkVFTn1CYXRjaCBzY2FuIGNvbXBsZXRlZCEgQ29tYmluZWQgcmVzdWx0cyBzYXZlZCB0bzoge291dHB1dF9maWxlfSIpCgogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYie0ZvcmUuUkVEfUVycm9yOiBGaWxlICd7YXJncy5saXN0fScgbm90IGZvdW5kIXtGb3JlLlJFU0VUfSIpCgoKZGVmIG1haW4oKToKICAgIGltcG9ydCBzdWJwcm9jZXNzCiAgICBmaWdsZXRfYmFubmVyID0gc3VicHJvY2Vzcy5nZXRvdXRwdXQoImZpZ2xldCAnWFNTIFRvb2wgYnkgSDRtemFYJyIpCiAgICAjIERpc3BsYXkgYmFubmVyIHdpdGggbG9sY2F0IGZvciBjb2xvcmZ1bG5lc3MKICAgIHN1YnByb2Nlc3MucnVuKGYnZWNobyAie2ZpZ2xldF9iYW5uZXJ9IiB8IGxvbGNhdCcsIHNoZWxsPVRydWUpCgogICAgYmFubmVyID0gZiIiIgp7Rm9yZS5NQUdFTlRBfQpBZHZhbmNlZCBYU1MgVnVsbmVyYWJpbGl0eSBIdW50ZXIgLSBDdXN0b20gRWRpdGlvbgp7Rm9yZS5ZRUxMT1d9RGV2ZWxvcGVkIGJ5IEg0bXphWAp7Rm9yZS5HUkVFTn1GZWF0dXJlczogQXV0byBXQUYgRGV0ZWN0aW9uIHwgQWR2YW5jZWQgVGVjaG5pcXVlcyB8IENyZWF0aXZlIE91dHB1dAp7U3R5bGUuUkVTRVRfQUxMfQoKIiIiCiAgICBwcmludChiYW5uZXIpCiAgICAKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSdBZHZhbmNlZCBYU1MgU2Nhbm5lcicpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctdScsICctLXVybCcsIGhlbHA9J1RhcmdldCBVUkwgdG8gc2NhbicpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctbCcsICctLWxpc3QnLCBoZWxwPSdGaWxlIGNvbnRhaW5pbmcgbGlzdCBvZiBVUkxzIHRvIHNjYW4gKG9uZSBwZXIgbGluZSknKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLXQnLCAnLS10aHJlYWRzJywgdHlwZT1pbnQsIGRlZmF1bHQ9MTAsIGhlbHA9J051bWJlciBvZiB0aHJlYWRzIChkZWZhdWx0OiAxMCknKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLWQnLCAnLS1kZWxheScsIHR5cGU9ZmxvYXQsIGRlZmF1bHQ9MCwgaGVscD0nRGVsYXkgYmV0d2VlbiByZXF1ZXN0cyBpbiBzZWNvbmRzJykKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy12JywgJy0tdmVyYm9zZScsIGFjdGlvbj0nc3RvcmVfdHJ1ZScsIGhlbHA9J1ZlcmJvc2Ugb3V0cHV0JykKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy1jJywgJy0tY3Jhd2wnLCBhY3Rpb249J3N0b3JlX3RydWUnLCBoZWxwPSdDcmF3bCB3ZWJzaXRlIGZvciBhZGRpdGlvbmFsIFVSTHMnKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLS1tYXgtZGVwdGgnLCB0eXBlPWludCwgZGVmYXVsdD0yLCBoZWxwPSdNYXhpbXVtIGNyYXdsIGRlcHRoIChkZWZhdWx0OiAyKScpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctLXVzZXItYWdlbnQnLCBoZWxwPSdDdXN0b20gVXNlci1BZ2VudCBzdHJpbmcnKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLW8nLCAnLS1vdXRwdXQnLCBoZWxwPSdPdXRwdXQgZmlsZSBmb3IgcmVzdWx0cyAoZGVmYXVsdDogYXV0by1nZW5lcmF0ZWQpJykKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy0tbm8tYnJvd3Nlci12ZXJpZnknLCBhY3Rpb249J3N0b3JlX2ZhbHNlJywgZGVzdD0nYnJvd3Nlcl92ZXJpZnknLCBoZWxwPSdEaXNhYmxlIGJyb3dzZXItYmFzZWQgdmVyaWZpY2F0aW9uJykKICAgIAogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIAogICAgIyBWYWxpZGF0ZSBpbnB1dCAtIGVpdGhlciBVUkwgb3IgbGlzdCBmaWxlIHJlcXVpcmVkCiAgICBpZiBub3QgYXJncy51cmwgYW5kIG5vdCBhcmdzLmxpc3Q6CiAgICAgICAgcGFyc2VyLmVycm9yKCJFaXRoZXIgLXUvLS11cmwgb3IgLWwvLS1saXN0IGlzIHJlcXVpcmVkIikKICAgIAogICAgaWYgYXJncy51cmwgYW5kIGFyZ3MubGlzdDoKICAgICAgICBwYXJzZXIuZXJyb3IoIkNhbm5vdCB1c2UgYm90aCAtdS8tLXVybCBhbmQgLWwvLS1saXN0IGF0IHRoZSBzYW1lIHRpbWUiKQogICAgCiAgICB0cnk6CiAgICAgICAgaWYgYXJncy5saXN0OgogICAgICAgICAgICAjIFNjYW4gbXVsdGlwbGUgVVJMcyBmcm9tIGZpbGUKICAgICAgICAgICAgc2Nhbl9mcm9tX2ZpbGUoYXJncykKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIFNjYW4gc2luZ2xlIFVSTAogICAgICAgICAgICBzY2FubmVyID0gWFNTU2Nhbm5lcigKICAgICAgICAgICAgICAgIHRhcmdldF91cmw9YXJncy51cmwsCiAgICAgICAgICAgICAgICB0aHJlYWRzPWFyZ3MudGhyZWFkcywKICAgICAgICAgICAgICAgIGRlbGF5PWFyZ3MuZGVsYXksCiAgICAgICAgICAgICAgICB2ZXJib3NlPWFyZ3MudmVyYm9zZSwKICAgICAgICAgICAgICAgIHVzZXJfYWdlbnQ9YXJncy51c2VyX2FnZW50LAogICAgICAgICAgICAgICAgb3V0cHV0X2ZpbGU9YXJncy5vdXRwdXQsCiAgICAgICAgICAgICAgICBicm93c2VyX3ZlcmlmeT1hcmdzLmJyb3dzZXJfdmVyaWZ5CiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNjYW5uZXIuc2NhbihjcmF3bD1hcmdzLmNyYXdsLCBtYXhfZGVwdGg9YXJncy5tYXhfZGVwdGgpCiAgICAgICAgCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcHJpbnQoZiJcbntGb3JlLllFTExPV31TY2FuIGludGVycnVwdGVkIGJ5IHVzZXIuIikKICAgICAgICBzeXMuZXhpdCgwKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYie0ZvcmUuUkVEfUVycm9yOiB7c3RyKGUpfSIpCiAgICAgICAgc3lzLmV4aXQoMSkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK').decode('utf-8'))
